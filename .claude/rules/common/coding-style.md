# コーディングスタイル

## イミュータビリティ（重要）

常に新しいオブジェクトを作成し、既存のオブジェクトを絶対に変更しないでください：

```
// 疑似コード
誤り:  modify(original, field, value) → 元のオブジェクトをその場で変更
正解: update(original, field, value) → 変更を含む新しいコピーを返す
```

根拠: イミュータブルなデータは隠れた副作用を防ぎ、デバッグを容易にし、安全な並行処理を可能にします。

## ファイル構成

少数の大きなファイルより多数の小さなファイルを優先：
- 高凝集、低結合
- 通常 200-400 行、最大 800 行
- 大きなモジュールからユーティリティを抽出
- 型ではなく、機能/ドメインごとに整理

## エラーハンドリング

常に包括的にエラーを処理してください：
- すべてのレベルで明示的にエラーを処理
- UI 向けコードではユーザーフレンドリーなエラーメッセージを提供
- サーバーサイドでは詳細なエラーコンテキストをログに記録
- エラーを静かに握りつぶさない

## 入力バリデーション

常にシステム境界でバリデーションを行ってください：
- 処理前にすべてのユーザー入力をバリデーション
- 利用可能な場合はスキーマベースのバリデーションを使用
- 明確なエラーメッセージで早期に失敗させる
- 外部データを決して信頼しない（API レスポンス、ユーザー入力、ファイル内容）

## コード品質チェックリスト

作業を完了とする前に確認：
- [ ] コードが読みやすく、適切な命名がされている
- [ ] 関数が小さい（50 行未満）
- [ ] ファイルが集約されている（800 行未満）
- [ ] 深いネストがない（4 レベル以上）
- [ ] 適切なエラーハンドリング
- [ ] ハードコードされた値がない（定数または設定を使用）
- [ ] ミューテーションがない（イミュータブルパターンを使用）
