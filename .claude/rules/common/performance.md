# パフォーマンス最適化

## モデル選択戦略

**Haiku 4.5**（Sonnetの90%の能力、コスト3分の1）:
- 頻繁に呼び出される軽量エージェント
- ペアプログラミングとコード生成
- マルチエージェントシステムのワーカーエージェント

**Sonnet 4.5**（最高のコーディングモデル）:
- メインの開発作業
- マルチエージェントワークフローのオーケストレーション
- 複雑なコーディングタスク

**Opus 4.5**（最も深い推論能力）:
- 複雑なアーキテクチャ決定
- 最大限の推論が必要な場合
- リサーチと分析タスク

## コンテキストウィンドウ管理

コンテキストウィンドウの最後の20%では以下を避ける:
- 大規模なリファクタリング
- 複数ファイルにまたがる機能実装
- 複雑な相互作用のデバッグ

コンテキスト感度が低いタスク:
- 単一ファイルの編集
- 独立したユーティリティの作成
- ドキュメント更新
- 単純なバグ修正

## 拡張思考 + Planモード

拡張思考はデフォルトで有効化されており、内部推論用に最大31,999トークンが予約されています。

拡張思考の制御方法:
- **切り替え**: Option+T (macOS) / Alt+T (Windows/Linux)
- **設定**: `~/.claude/settings.json` で `alwaysThinkingEnabled` を設定
- **バジェット上限**: `export MAX_THINKING_TOKENS=10000`
- **詳細モード**: Ctrl+O で思考出力を表示

深い推論が必要な複雑なタスクには:
1. 拡張思考が有効であることを確認（デフォルトでオン）
2. 構造化されたアプローチのために **Planモード** を有効化
3. 複数回の批評ラウンドで徹底的に分析
4. 多様な視点のために役割分担したサブエージェントを使用

## ビルドトラブルシューティング

ビルドが失敗した場合:
1. **build-error-resolver** エージェントを使用する
2. エラーメッセージを分析する
3. 段階的に修正する
4. 各修正後に検証する
