---
description: Playwrightを使用してE2Eテストを生成・実行。テストジャーニーを作成し、テストを実行し、スクリーンショット/ビデオ/トレースをキャプチャし、アーティファクトをアップロードします。
---

# E2Eコマンド

このコマンドは**e2e-runner**エージェントを呼び出し、Playwrightを使用してE2Eテストを生成、メンテナンス、実行します。

## このコマンドの機能

1. **テストジャーニー生成** - ユーザーフローのPlaywrightテストを作成
2. **E2Eテスト実行** - 複数ブラウザでテストを実行
3. **アーティファクトキャプチャ** - 失敗時にスクリーンショット、ビデオ、トレースを取得
4. **結果アップロード** - HTMLレポートとJUnit XML
5. **不安定テスト特定** - 不安定なテストを隔離

## 使用タイミング

`/e2e`を使用する場合:
- クリティカルなユーザージャーニーのテスト（ログイン、取引、決済）
- マルチステップフローがエンドツーエンドで動作することを確認
- UIインタラクションとナビゲーションのテスト
- フロントエンドとバックエンド間の統合を検証
- 本番デプロイの準備

## 動作方法

e2e-runnerエージェントは以下を行います:

1. **ユーザーフローを分析**してテストシナリオを特定
2. **Playwrightテストを生成**（Page Object Modelパターン使用）
3. **テストを実行**（複数ブラウザ: Chrome、Firefox、Safari）
4. **失敗をキャプチャ**（スクリーンショット、ビデオ、トレース付き）
5. **レポートを生成**（結果とアーティファクト付き）
6. **不安定テストを特定**して修正を推奨

## クイックコマンド

```bash
# すべてのE2Eテストを実行
npx playwright test

# 特定のテストファイルを実行
npx playwright test tests/e2e/markets/search.spec.ts

# ヘッドモードで実行（ブラウザを表示）
npx playwright test --headed

# テストをデバッグ
npx playwright test --debug

# テストコードを生成
npx playwright codegen http://localhost:3000

# レポートを表示
npx playwright show-report
```

## ベストプラクティス

**すべきこと:**
- ✅ 保守性のためPage Object Modelを使用
- ✅ セレクターにdata-testid属性を使用
- ✅ 任意のタイムアウトではなくAPIレスポンスを待つ
- ✅ クリティカルなユーザージャーニーをエンドツーエンドでテスト
- ✅ mainにマージする前にテストを実行
- ✅ テスト失敗時にアーティファクトをレビュー

**すべきでないこと:**
- ❌ 脆弱なセレクターを使用（CSSクラスは変更される可能性あり）
- ❌ 実装詳細をテスト
- ❌ 本番環境に対してテストを実行
- ❌ 不安定なテストを無視
- ❌ 失敗時のアーティファクトレビューをスキップ
- ❌ すべてのエッジケースをE2Eでテスト（ユニットテストを使用）

## 関連エージェント

このコマンドは`e2e-runner`エージェントを呼び出します:
`~/.claude/agents/e2e-runner.md`
